<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support-docs API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="file"],
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .loading {
            display: none;
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background-color: #27ae60; }
        .status-offline { background-color: #e74c3c; }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            border-bottom-color: #3498db;
            background-color: #ecf0f1;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ Support-docs API ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</h1>
        
        <!-- ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª -->
        <div class="test-section">
            <h2>ğŸ¥ ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª</h2>
            <button onclick="checkServerHealth()">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
            <div id="healthResult" class="result info" style="display: none;"></div>
        </div>

        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('audio')">éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</div>
            <div class="tab" onclick="switchTab('pdf')">PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ</div>
            <div class="tab" onclick="switchTab('accuracy')">ç²¾åº¦æ¸¬å®šãƒ†ã‚¹ãƒˆ</div>
            <div class="tab" onclick="switchTab('documents')">ğŸ“‹ è¤‡æ•°å¸³ç¥¨ç”Ÿæˆ</div>
            <div class="tab" onclick="switchTab('database')">ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¥åŠ›</div>
            <div class="tab" onclick="switchTab('integrated')">ğŸ¯ çµ±åˆãƒ†ã‚¹ãƒˆ</div>
        </div>

        <!-- éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ -->
        <div id="audioTab" class="tab-content active">
            <div class="test-section">
                <h2>ğŸ¤ éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</h2>
                
                <div class="form-group">
                    <label for="audioFile">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (.mp3, .wav, .m4a, .aac)</label>
                    <input type="file" id="audioFile" accept=".mp3,.wav,.m4a,.aac">
                </div>
                
                <div class="form-group">
                    <label for="promptType">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚¤ãƒ—</label>
                    <select id="promptType">
                        <option value="WELFARE">ç¦ç¥‰é¢è«‡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</option>
                        <option value="ASSESSMENT">ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé¢è«‡</option>
                        <option value="MONITORING">ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é¢è«‡</option>
                    </select>
                </div>

                <button onclick="uploadOnly()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿</button>
                <button onclick="testUpload()" style="background-color: #f39c12;">ğŸ§ª æ¥ç¶šãƒ†ã‚¹ãƒˆ (APIã‚­ãƒ¼ä¸è¦)</button>
                <button onclick="demoTranscribe()" style="background-color: #9b59b6;">ğŸ¬ ãƒ‡ãƒ¢æ–‡å­—èµ·ã“ã— (APIã‚­ãƒ¼ä¸è¦)</button>
                <button onclick="uploadAndTranscribe()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ + éŸ³å£°èªè­˜ (APIã‚­ãƒ¼å¿…è¦)</button>
                <button onclick="uploadTranscribeAnalyze()">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ + éŸ³å£°èªè­˜ + AIè§£æ (APIã‚­ãƒ¼å¿…è¦)</button>
                
                <div class="loading" id="audioLoading">ğŸµ å‡¦ç†ä¸­...</div>
                <div id="audioResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ -->
        <div id="pdfTab" class="tab-content">
            <div class="test-section">
                <h2>ğŸ“„ PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ</h2>
                
                <div class="form-group">
                    <label for="pdfType">PDFç¨®é¡</label>
                    <select id="pdfType">
                        <option value="assessment-sheet">ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆè¡¨</option>
                        <option value="interview-record">é¢è«‡è¨˜éŒ²</option>
                        <option value="service-record">ã‚µãƒ¼ãƒ“ã‚¹æä¾›å®Ÿç¸¾è¨˜éŒ²è¡¨</option>
                        <option value="individual-support-plan">å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸</option>
                        <option value="monitoring-record">ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²è¡¨</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="userName">åˆ©ç”¨è€…å</label>
                    <input type="text" id="userName" placeholder="ç”°ä¸­å¤ªéƒ" value="ç”°ä¸­å¤ªéƒ">
                </div>
                
                <div class="form-group">
                    <label for="staffName">æ”¯æ´å“¡å</label>
                    <input type="text" id="staffName" placeholder="ä½è—¤æ”¯æ´å“¡" value="ä½è—¤æ”¯æ´å“¡">
                </div>
                
                <div class="form-group">
                    <label for="transcriptionText">éŸ³å£°èªè­˜ãƒ†ã‚­ã‚¹ãƒˆï¼ˆé¢è«‡è¨˜éŒ²ç”¨ï¼‰</label>
                    <textarea id="transcriptionText" placeholder="éŸ³å£°èªè­˜çµæœãŒã“ã“ã«å…¥åŠ›ã•ã‚Œã¾ã™...">ä»Šæ—¥ã¯å€‹åˆ¥é¢è«‡ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ç¾åœ¨ã®å°±åŠ´çŠ¶æ³ã«ã¤ã„ã¦ãŠèã‹ã›ãã ã•ã„ã€‚</textarea>
                </div>

                <button onclick="generatePDF()">PDFç”Ÿæˆå®Ÿè¡Œ</button>
                
                <div class="loading" id="pdfLoading">ğŸ“„ PDFç”Ÿæˆä¸­...</div>
                <div id="pdfResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- ç²¾åº¦æ¸¬å®šãƒ†ã‚¹ãƒˆ -->
        <div id="accuracyTab" class="tab-content">
            <div class="test-section">
                <h2>ğŸ“Š ç²¾åº¦æ¸¬å®šãƒ†ã‚¹ãƒˆ</h2>
                
                <div class="form-group">
                    <label for="testAudioFile">ãƒ†ã‚¹ãƒˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«</label>
                    <input type="file" id="testAudioFile" accept=".mp3,.wav,.m4a,.aac">
                </div>
                
                <div class="form-group">
                    <label for="groundTruth">æ­£è§£ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ‰‹å‹•å…¥åŠ›ï¼‰</label>
                    <textarea id="groundTruth" placeholder="éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ­£ã—ã„å†…å®¹ã‚’ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                </div>

                <button onclick="measureAccuracy()">ç²¾åº¦æ¸¬å®šå®Ÿè¡Œ</button>
                
                <div class="loading" id="accuracyLoading">ğŸ“Š ç²¾åº¦æ¸¬å®šä¸­...</div>
                <div id="accuracyResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- è¤‡æ•°å¸³ç¥¨ç”Ÿæˆãƒ†ã‚¹ãƒˆ -->
        <div id="documentsTab" class="tab-content">
            <div class="test-section">
                <h2>ğŸ“‹ è¤‡æ•°å¸³ç¥¨åŒæ™‚ç”Ÿæˆãƒ†ã‚¹ãƒˆ</h2>
                
                <div class="form-group">
                    <label for="documentsAudioFile">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (.mp3, .wav, .m4a, .aac)</label>
                    <input type="file" id="documentsAudioFile" accept=".mp3,.wav,.m4a,.aac">
                </div>
                
                <div class="form-group">
                    <label for="documentsUserName">åˆ©ç”¨è€…å</label>
                    <input type="text" id="documentsUserName" placeholder="ç”°ä¸­å¤ªéƒ" value="ç”°ä¸­å¤ªéƒ">
                </div>
                
                <div class="form-group">
                    <label for="documentsStaffName">æ”¯æ´å“¡å</label>
                    <input type="text" id="documentsStaffName" placeholder="ä½è—¤æ”¯æ´å“¡" value="ä½è—¤æ”¯æ´å“¡">
                </div>

                <div class="form-group">
                    <label>ğŸ“‹ ç”Ÿæˆã™ã‚‹å¸³ç¥¨ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="doc_individual_support_plan" value="individual-support-plan" style="margin-right: 8px;">
                            å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸ - æ”¯æ´ç›®æ¨™ã¨å…·ä½“çš„ãªæ”¯æ´å†…å®¹
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="doc_monitoring_record" value="monitoring-record" style="margin-right: 8px;">
                            ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²è¡¨ - æ”¯æ´è¨ˆç”»ã®é€²æ—çŠ¶æ³ã¨è©•ä¾¡
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="doc_family_report" value="family-report" style="margin-right: 8px;">
                            å®¶æ—å‘ã‘å ±å‘Šæ›¸ - æ´»å‹•å ±å‘Šã¨è¿‘æ³ãŠçŸ¥ã‚‰ã›
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="doc_service_record" value="service-record" style="margin-right: 8px;">
                            ã‚µãƒ¼ãƒ“ã‚¹æä¾›å®Ÿç¸¾è¨˜éŒ²è¡¨ - æä¾›ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°è¨˜éŒ²
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="doc_assessment_sheet" value="assessment-sheet" style="margin-right: 8px;">
                            ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆè¡¨ - èƒ½åŠ›è©•ä¾¡ã¨èª²é¡Œåˆ†æ
                        </label>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <button onclick="suggestDocuments()" style="background-color: #9b59b6;">ğŸ¤– AIæ¨å¥¨å¸³ç¥¨ã‚’ææ¡ˆ</button>
                    <button onclick="previewDocumentGeneration()" style="background-color: #f39c12;">ğŸ‘ï¸ ç”Ÿæˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                    <button onclick="generateMultipleDocuments()" style="background-color: #27ae60;">ğŸ“„ é¸æŠå¸³ç¥¨ã‚’ä¸€æ‹¬ç”Ÿæˆ</button>
                </div>

                <div class="loading" id="documentsLoading">ğŸ“‹ å¸³ç¥¨ç”Ÿæˆä¸­...</div>
                <div id="documentsResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•å…¥åŠ›ãƒ†ã‚¹ãƒˆ -->
        <div id="databaseTab" class="tab-content">
            <div class="test-section">
                <h2>ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•å…¥åŠ›ãƒ†ã‚¹ãƒˆ</h2>
                
                <div class="form-group">
                    <label for="databaseAudioFile">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (.mp3, .wav, .m4a, .aac)</label>
                    <input type="file" id="databaseAudioFile" accept=".mp3,.wav,.m4a,.aac">
                </div>
                
                <div class="form-group">
                    <label for="databaseUserName">åˆ©ç”¨è€…å</label>
                    <input type="text" id="databaseUserName" placeholder="ç”°ä¸­å¤ªéƒ" value="ç”°ä¸­å¤ªéƒ">
                </div>
                
                <div class="form-group">
                    <label for="databaseStaffName">æ”¯æ´å“¡å</label>
                    <input type="text" id="databaseStaffName" placeholder="ä½è—¤æ”¯æ´å“¡" value="ä½è—¤æ”¯æ´å“¡">
                </div>

                <div class="form-group">
                    <label>ğŸ—ƒï¸ æ›´æ–°ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_user_master" value="user_master" style="margin-right: 8px;">
                            åˆ©ç”¨è€…ãƒã‚¹ã‚¿ - å¹´é½¢ã€éšœå®³ç¨®åˆ¥ã€æ”¯æ´åŒºåˆ†ã€é€£çµ¡å…ˆã€åŒ»ç™‚æƒ…å ±
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_service_records" value="service_records" style="margin-right: 8px;">
                            ã‚µãƒ¼ãƒ“ã‚¹æä¾›å®Ÿç¸¾ - ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥ã€æä¾›æ™‚é–“ã€åˆ©ç”¨è€…çŠ¶æ…‹ã€æ´»å‹•å†…å®¹
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_goal_evaluations" value="goal_evaluations" style="margin-right: 8px;">
                            ç›®æ¨™é”æˆåº¦è©•ä¾¡ - ç›®æ¨™ã‚«ãƒ†ã‚´ãƒªã€é”æˆåº¦ã€è©•ä¾¡å†…å®¹ã€æ¬¡ã®ç›®æ¨™
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_attendance_records" value="attendance_records" style="margin-right: 8px;">
                            å‡ºå¸­è¨˜éŒ² - å‡ºå¸­çŠ¶æ³ã€å‚åŠ åº¦ã€æ¬ å¸­ç†ç”±ã€æ—©é€€ãƒ»é…åˆ»
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_communication_logs" value="communication_logs" style="margin-right: 8px;">
                            ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ² - é€£çµ¡å…ˆã€é€£çµ¡å†…å®¹ã€é€£çµ¡æ—¥æ™‚ã€å¯¾å¿œè€…
                        </label>
                        <label style="display: flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                            <input type="checkbox" id="table_medical_records" value="medical_records" style="margin-right: 8px;">
                            åŒ»ç™‚ãƒ»å¥åº·è¨˜éŒ² - æœè–¬æƒ…å ±ã€é€šé™¢çŠ¶æ³ã€å¥åº·çŠ¶æ…‹ã€åŒ»ç™‚æ©Ÿé–¢
                        </label>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <button onclick="suggestTables()" style="background-color: #9b59b6;">ğŸ¤– AIæ¨å¥¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ææ¡ˆ</button>
                    <button onclick="previewDatabaseUpdate()" style="background-color: #f39c12;">ğŸ‘ï¸ æ›´æ–°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                    <button onclick="updateDatabase()" style="background-color: #e74c3c;">ğŸ’¾ é¸æŠãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¸€æ‹¬æ›´æ–°</button>
                </div>

                <div class="loading" id="databaseLoading">ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ä¸­...</div>
                <div id="databaseResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div id="integratedTab" class="tab-content">
            <div class="test-section">
                <h2>ğŸ¯ çµ±åˆãƒ†ã‚¹ãƒˆ - ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å®Œå…¨è‡ªå‹•åŒ–</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    1å›ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¤‡æ•°å¸³ç¥¨ç”Ÿæˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ã‚’åŒæ™‚å®Ÿè¡Œã—ã€<br>
                    <strong>å¾“æ¥125åˆ†ã®ä½œæ¥­ã‚’6åˆ†ã«çŸ­ç¸®</strong>ã™ã‚‹å®Œå…¨è‡ªå‹•åŒ–ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
                </p>
                
                <div class="form-group">
                    <label for="integratedAudioFile">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (.mp3, .wav, .m4a, .aac)</label>
                    <input type="file" id="integratedAudioFile" accept=".mp3,.wav,.m4a,.aac">
                </div>
                
                <div class="form-group">
                    <label for="integratedUserName">åˆ©ç”¨è€…å</label>
                    <input type="text" id="integratedUserName" placeholder="ç”°ä¸­å¤ªéƒ" value="ç”°ä¸­å¤ªéƒ">
                </div>
                
                <div class="form-group">
                    <label for="integratedStaffName">æ”¯æ´å“¡å</label>
                    <input type="text" id="integratedStaffName" placeholder="ä½è—¤æ”¯æ´å“¡" value="ä½è—¤æ”¯æ´å“¡">
                </div>

                <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="color: #27ae60; margin-top: 0;">ğŸš€ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†å†…å®¹</h3>
                    <ul style="margin: 10px 0; color: #555;">
                        <li>âœ… éŸ³å£°èªè­˜ï¼ˆç²¾åº¦å‘ä¸Šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + å‰å‡¦ç†é©ç”¨ï¼‰</li>
                        <li>âœ… AIæ¨å¥¨å¸³ç¥¨ã®è‡ªå‹•é¸æŠãƒ»ç”Ÿæˆ</li>
                        <li>âœ… AIæ¨å¥¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®è‡ªå‹•é¸æŠãƒ»æ›´æ–°</li>
                        <li>âœ… å‡¦ç†æ™‚é–“ãƒ»ROIåŠ¹æœã®è¨ˆæ¸¬</li>
                    </ul>
                </div>

                <div style="margin-bottom: 15px;">
                    <button onclick="executeIntegratedProcess()" style="background-color: #2ecc71; font-size: 18px; padding: 15px 30px;">
                        ğŸ¯ å®Œå…¨è‡ªå‹•åŒ–å®Ÿè¡Œ (125åˆ†â†’6åˆ†)
                    </button>
                </div>

                <div class="loading" id="integratedLoading">ğŸ¯ å®Œå…¨è‡ªå‹•åŒ–å‡¦ç†ä¸­...</div>
                <div id="integratedResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆã‚’è‡ªå‹•æ¤œå‡ºã¾ãŸã¯3000ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
        const API_BASE = window.location.port === '3000' ? window.location.origin : 'http://localhost:3000';

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®æ›´æ–°
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ›´æ–°
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
        async function checkServerHealth() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                document.getElementById('healthResult').style.display = 'block';
                document.getElementById('healthResult').className = 'result success';
                document.getElementById('healthResult').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('healthResult').style.display = 'block';
                document.getElementById('healthResult').className = 'result error';
                document.getElementById('healthResult').textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }

        // éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿
        async function uploadOnly() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);

            showLoading('audioLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/audio/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('audioResult', data, response.ok);
            } catch (error) {
                showResult('audioResult', { error: error.message }, false);
            } finally {
                hideLoading('audioLoading');
            }
        }

        // éŸ³å£°èªè­˜
        async function uploadAndTranscribe() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);

            showLoading('audioLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/audio/upload-and-transcribe`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('audioResult', data, response.ok);
                
                // æˆåŠŸæ™‚ã¯çµæœã‚’PDFã‚¿ãƒ–ã«ã‚³ãƒ”ãƒ¼
                if (response.ok && data.transcription) {
                    document.getElementById('transcriptionText').value = data.transcription.text;
                }
            } catch (error) {
                showResult('audioResult', { error: error.message }, false);
            } finally {
                hideLoading('audioLoading');
            }
        }

        // ãƒ†ã‚¹ãƒˆç”¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (APIã‚­ãƒ¼ä¸è¦)
        async function testUpload() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);

            showLoading('audioLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/audio/test-upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('audioResult', data, response.ok);
            } catch (error) {
                showResult('audioResult', { error: error.message }, false);
            } finally {
                hideLoading('audioLoading');
            }
        }

        // ãƒ‡ãƒ¢ç”¨æ–‡å­—èµ·ã“ã— (APIã‚­ãƒ¼ä¸è¦)
        async function demoTranscribe() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);

            showLoading('audioLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/audio/demo-transcribe`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('audioResult', data, response.ok);
                
                // æˆåŠŸæ™‚ã¯çµæœã‚’PDFã‚¿ãƒ–ã«ã‚³ãƒ”ãƒ¼
                if (response.ok && data.transcription) {
                    document.getElementById('transcriptionText').value = data.transcription.text;
                }
            } catch (error) {
                showResult('audioResult', { error: error.message }, false);
            } finally {
                hideLoading('audioLoading');
            }
        }

        // AIè§£æä»˜ãéŸ³å£°èªè­˜
        async function uploadTranscribeAnalyze() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);

            showLoading('audioLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/audio/upload-transcribe-analyze`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('audioResult', data, response.ok);
                
                // æˆåŠŸæ™‚ã¯çµæœã‚’PDFã‚¿ãƒ–ã«ã‚³ãƒ”ãƒ¼
                if (response.ok && data.transcription) {
                    document.getElementById('transcriptionText').value = data.transcription.text;
                }
            } catch (error) {
                showResult('audioResult', { error: error.message }, false);
            } finally {
                hideLoading('audioLoading');
            }
        }

        // PDFç”Ÿæˆ
        async function generatePDF() {
            const pdfType = document.getElementById('pdfType').value;
            const userName = document.getElementById('userName').value;
            const staffName = document.getElementById('staffName').value;
            const transcriptionText = document.getElementById('transcriptionText').value;

            if (!userName) {
                alert('åˆ©ç”¨è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const requestData = {
                userName: userName,
                staffName: staffName,
                transcriptionText: transcriptionText,
                age: '25',
                disabilityType: 'ç²¾ç¥éšœå®³',
                assessor: staffName
            };

            showLoading('pdfLoading');
            
            try {
                const response = await fetch(`${API_BASE}/api/pdf/${pdfType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                showResult('pdfResult', data, response.ok);
                
                // æˆåŠŸæ™‚ã¯PDFãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
                if (response.ok && data.filename) {
                    const pdfLink = `${API_BASE}/generated/${data.filename}`;
                    const linkElement = document.createElement('a');
                    linkElement.href = pdfLink;
                    linkElement.target = '_blank';
                    linkElement.textContent = 'PDFã‚’é–‹ã';
                    linkElement.style.display = 'block';
                    linkElement.style.marginTop = '10px';
                    linkElement.style.color = '#3498db';
                    
                    const resultDiv = document.getElementById('pdfResult');
                    resultDiv.appendChild(linkElement);
                }
            } catch (error) {
                showResult('pdfResult', { error: error.message }, false);
            } finally {
                hideLoading('pdfLoading');
            }
        }

        // ç²¾åº¦æ¸¬å®šï¼ˆãƒ‡ãƒ¢ç‰ˆï¼‰
        async function measureAccuracy() {
            const fileInput = document.getElementById('testAudioFile');
            const groundTruth = document.getElementById('groundTruth').value;
            
            if (!fileInput.files[0]) {
                alert('ãƒ†ã‚¹ãƒˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!groundTruth.trim()) {
                alert('æ­£è§£ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showLoading('accuracyLoading');
            
            try {
                // ã¾ãšéŸ³å£°èªè­˜ã‚’å®Ÿè¡Œ
                const formData = new FormData();
                formData.append('audioFile', fileInput.files[0]);

                const response = await fetch(`${API_BASE}/api/audio/upload-and-transcribe`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok && data.transcription) {
                    // ç°¡æ˜“ç²¾åº¦è¨ˆç®—ï¼ˆå®Ÿéš›ã®ç²¾åº¦æ¸¬å®šAPIã¯åˆ¥é€”å®Ÿè£…ï¼‰
                    const predicted = data.transcription.text;
                    const actual = groundTruth.trim();
                    
                    const accuracy = calculateSimpleAccuracy(predicted, actual);
                    
                    const result = {
                        ...data,
                        accuracy: accuracy,
                        comparison: {
                            predicted: predicted,
                            actual: actual
                        }
                    };
                    
                    showResult('accuracyResult', result, true);
                } else {
                    showResult('accuracyResult', data, false);
                }
            } catch (error) {
                showResult('accuracyResult', { error: error.message }, false);
            } finally {
                hideLoading('accuracyLoading');
            }
        }

        // ç°¡æ˜“ç²¾åº¦è¨ˆç®—
        function calculateSimpleAccuracy(predicted, actual) {
            const predictedWords = predicted.toLowerCase().split(/\s+/);
            const actualWords = actual.toLowerCase().split(/\s+/);
            
            let correct = 0;
            const maxLength = Math.max(predictedWords.length, actualWords.length);
            
            for (let i = 0; i < Math.min(predictedWords.length, actualWords.length); i++) {
                if (predictedWords[i] === actualWords[i]) {
                    correct++;
                }
            }
            
            return {
                wordAccuracy: maxLength > 0 ? (correct / maxLength) * 100 : 0,
                characterAccuracy: calculateCharacterAccuracy(predicted, actual)
            };
        }

        function calculateCharacterAccuracy(predicted, actual) {
            const predictedChars = predicted.replace(/\s/g, '').split('');
            const actualChars = actual.replace(/\s/g, '').split('');
            
            let correct = 0;
            const maxLength = Math.max(predictedChars.length, actualChars.length);
            
            for (let i = 0; i < Math.min(predictedChars.length, actualChars.length); i++) {
                if (predictedChars[i] === actualChars[i]) {
                    correct++;
                }
            }
            
            return maxLength > 0 ? (correct / maxLength) * 100 : 0;
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function showLoading(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showResult(elementId, data, isSuccess) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        // ===== è¤‡æ•°å¸³ç¥¨ç”Ÿæˆæ©Ÿèƒ½ =====

        // AIæ¨å¥¨å¸³ç¥¨ã‚’ææ¡ˆ
        async function suggestDocuments() {
            const transcriptionText = document.getElementById('transcriptionText')?.value || 
                                    'éšœå®³ç¦ç¥‰é¢è«‡ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚ç›®æ¨™è¨­å®šã«ã¤ã„ã¦è©±ã—åˆã„ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã—ãŸã€‚';

            try {
                const response = await fetch(`${API_BASE}/api/documents/suggest`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transcriptionText: transcriptionText,
                        userContext: {}
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // æ¨å¥¨ã•ã‚ŒãŸå¸³ç¥¨ã‚’è‡ªå‹•é¸æŠ
                    document.querySelectorAll('input[id^="doc_"]').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    data.suggestions.forEach(suggestion => {
                        const checkbox = document.getElementById(`doc_${suggestion.type.replace(/-/g, '_')}`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });

                    showResult('documentsResult', {
                        message: 'æ¨å¥¨å¸³ç¥¨ã‚’è‡ªå‹•é¸æŠã—ã¾ã—ãŸ',
                        suggestions: data.suggestions
                    }, true);
                } else {
                    showResult('documentsResult', data, false);
                }
            } catch (error) {
                showResult('documentsResult', { error: error.message }, false);
            }
        }

        // å¸³ç¥¨ç”Ÿæˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        async function previewDocumentGeneration() {
            const selectedDocs = getSelectedDocuments();
            const userName = document.getElementById('documentsUserName').value;
            const staffName = document.getElementById('documentsStaffName').value;

            if (selectedDocs.length === 0) {
                alert('ç”Ÿæˆã™ã‚‹å¸³ç¥¨ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const transcriptionText = document.getElementById('transcriptionText')?.value || 
                                    'ã‚µãƒ³ãƒ—ãƒ«é¢è«‡è¨˜éŒ²: åˆ©ç”¨è€…ã¨ã®é¢è«‡ã‚’å®Ÿæ–½ã—ã€ä»Šå¾Œã®æ”¯æ´ã«ã¤ã„ã¦è©±ã—åˆã„ã¾ã—ãŸã€‚';

            try {
                const response = await fetch(`${API_BASE}/api/documents/preview`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transcriptionText: transcriptionText,
                        selectedDocuments: selectedDocs,
                        userName: userName,
                        staffName: staffName
                    })
                });

                const data = await response.json();
                showResult('documentsResult', data, response.ok);
            } catch (error) {
                showResult('documentsResult', { error: error.message }, false);
            }
        }

        // è¤‡æ•°å¸³ç¥¨ã‚’ç”Ÿæˆ
        async function generateMultipleDocuments() {
            const fileInput = document.getElementById('documentsAudioFile');
            const selectedDocs = getSelectedDocuments();
            const userName = document.getElementById('documentsUserName').value;
            const staffName = document.getElementById('documentsStaffName').value;

            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            if (selectedDocs.length === 0) {
                alert('ç”Ÿæˆã™ã‚‹å¸³ç¥¨ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);
            formData.append('selectedDocuments', JSON.stringify(selectedDocs));
            formData.append('userName', userName);
            formData.append('staffName', staffName);

            showLoading('documentsLoading');

            try {
                const response = await fetch(`${API_BASE}/api/documents/generate-multiple-from-audio`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResult('documentsResult', data, response.ok);
            } catch (error) {
                showResult('documentsResult', { error: error.message }, false);
            } finally {
                hideLoading('documentsLoading');
            }
        }

        function getSelectedDocuments() {
            const selected = [];
            document.querySelectorAll('input[id^="doc_"]:checked').forEach(checkbox => {
                selected.push(checkbox.value);
            });
            return selected;
        }

        // ===== ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•å…¥åŠ›æ©Ÿèƒ½ =====

        // AIæ¨å¥¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ææ¡ˆ
        async function suggestTables() {
            const transcriptionText = document.getElementById('transcriptionText')?.value || 
                                    '25æ­³ã®åˆ©ç”¨è€…ã€ç²¾ç¥éšœå®³ã€ã‚µãƒ¼ãƒ“ã‚¹æä¾›å®Ÿç¸¾ã‚’è¨˜éŒ²ã€‚ç›®æ¨™é”æˆåº¦ã¯è‰¯å¥½ã€‚';

            try {
                const response = await fetch(`${API_BASE}/api/database/suggest-tables`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transcriptionText: transcriptionText,
                        userContext: {}
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // æ¨å¥¨ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è‡ªå‹•é¸æŠ
                    document.querySelectorAll('input[id^="table_"]').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    data.suggestions.forEach(suggestion => {
                        const checkbox = document.getElementById(`table_${suggestion.table}`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });

                    showResult('databaseResult', {
                        message: 'æ¨å¥¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è‡ªå‹•é¸æŠã—ã¾ã—ãŸ',
                        suggestions: data.suggestions
                    }, true);
                } else {
                    showResult('databaseResult', data, false);
                }
            } catch (error) {
                showResult('databaseResult', { error: error.message }, false);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        async function previewDatabaseUpdate() {
            const selectedTables = getSelectedTables();
            const userName = document.getElementById('databaseUserName').value;
            const staffName = document.getElementById('databaseStaffName').value;

            if (selectedTables.length === 0) {
                alert('æ›´æ–°ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const transcriptionText = document.getElementById('transcriptionText')?.value || 
                                    '25æ­³ã€ç²¾ç¥éšœå®³ã€ä»Šæ—¥ã¯ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã‚’å®Ÿæ–½ã€‚ç›®æ¨™é”æˆåº¦ã¯è‰¯å¥½ã§ã—ãŸã€‚';

            try {
                const response = await fetch(`${API_BASE}/api/database/preview-update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transcriptionText: transcriptionText,
                        targetTables: selectedTables,
                        userName: userName,
                        staffName: staffName
                    })
                });

                const data = await response.json();
                showResult('databaseResult', data, response.ok);
            } catch (error) {
                showResult('databaseResult', { error: error.message }, false);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°
        async function updateDatabase() {
            const fileInput = document.getElementById('databaseAudioFile');
            const selectedTables = getSelectedTables();
            const userName = document.getElementById('databaseUserName').value;
            const staffName = document.getElementById('databaseStaffName').value;

            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            if (selectedTables.length === 0) {
                alert('æ›´æ–°ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const formData = new FormData();
            formData.append('audioFile', fileInput.files[0]);
            formData.append('targetTables', JSON.stringify(selectedTables));
            formData.append('userName', userName);
            formData.append('staffName', staffName);

            showLoading('databaseLoading');

            try {
                const response = await fetch(`${API_BASE}/api/database/process-audio`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showResult('databaseResult', data, response.ok);
            } catch (error) {
                showResult('databaseResult', { error: error.message }, false);
            } finally {
                hideLoading('databaseLoading');
            }
        }

        function getSelectedTables() {
            const selected = [];
            document.querySelectorAll('input[id^="table_"]:checked').forEach(checkbox => {
                selected.push(checkbox.value);
            });
            return selected;
        }

        // ===== çµ±åˆãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ =====

        // å®Œå…¨è‡ªå‹•åŒ–å®Ÿè¡Œ
        async function executeIntegratedProcess() {
            const fileInput = document.getElementById('integratedAudioFile');
            const userName = document.getElementById('integratedUserName').value;
            const staffName = document.getElementById('integratedStaffName').value;

            if (!fileInput.files[0]) {
                alert('éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            showLoading('integratedLoading');
            const startTime = Date.now();

            try {
                // Step 1: éŸ³å£°èªè­˜
                const transcriptionResult = await performTranscription(fileInput.files[0]);
                
                // Step 2: AIæ¨å¥¨ã®å–å¾—
                const suggestions = await getAISuggestions(transcriptionResult.transcription.text);
                
                // Step 3: è¤‡æ•°å¸³ç¥¨ç”Ÿæˆ
                const documentsResult = await generateRecommendedDocuments(
                    fileInput.files[0], suggestions.documents, userName, staffName
                );
                
                // Step 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
                const databaseResult = await updateRecommendedTables(
                    fileInput.files[0], suggestions.tables, userName, staffName
                );

                const endTime = Date.now();
                const processingTime = (endTime - startTime) / 1000;

                const result = {
                    success: true,
                    message: `ğŸ‰ å®Œå…¨è‡ªå‹•åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸï¼`,
                    processingTime: `${processingTime.toFixed(1)}ç§’`,
                    timeSavings: `å¾“æ¥125åˆ† â†’ è‡ªå‹•åŒ–${processingTime.toFixed(1)}ç§’ = ${(7500 - processingTime).toFixed(1)}ç§’çŸ­ç¸®`,
                    costSavings: `äººä»¶è²»å‰Šæ¸›åŠ¹æœ: ç´„${Math.round((7500 - processingTime) / 60 * 50)}å††`,
                    transcription: transcriptionResult,
                    documentsGenerated: documentsResult.generationResult?.generatedCount || 0,
                    tablesUpdated: databaseResult.databaseResult?.updatedTables || 0,
                    details: {
                        documents: documentsResult,
                        database: databaseResult
                    }
                };

                showResult('integratedResult', result, true);

            } catch (error) {
                const endTime = Date.now();
                const processingTime = (endTime - startTime) / 1000;
                
                showResult('integratedResult', {
                    success: false,
                    message: 'çµ±åˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
                    processingTime: `${processingTime.toFixed(1)}ç§’`,
                    error: error.message
                }, false);
            } finally {
                hideLoading('integratedLoading');
            }
        }

        async function performTranscription(audioFile) {
            const formData = new FormData();
            formData.append('audioFile', audioFile);
            
            const response = await fetch(`${API_BASE}/api/audio/upload-and-transcribe`, {
                method: 'POST',
                body: formData
            });
            
            return await response.json();
        }

        async function getAISuggestions(transcriptionText) {
            const [docSuggestions, tableSuggestions] = await Promise.all([
                fetch(`${API_BASE}/api/documents/suggest`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ transcriptionText })
                }).then(res => res.json()),
                
                fetch(`${API_BASE}/api/database/suggest-tables`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ transcriptionText })
                }).then(res => res.json())
            ]);

            return {
                documents: docSuggestions.suggestions?.map(s => s.type) || ['individual-support-plan'],
                tables: tableSuggestions.originalSuggestions || ['user_master', 'service_records']
            };
        }

        async function generateRecommendedDocuments(audioFile, documentTypes, userName, staffName) {
            const formData = new FormData();
            formData.append('audioFile', audioFile);
            formData.append('selectedDocuments', JSON.stringify(documentTypes));
            formData.append('userName', userName);
            formData.append('staffName', staffName);

            const response = await fetch(`${API_BASE}/api/documents/generate-multiple-from-audio`, {
                method: 'POST',
                body: formData
            });

            return await response.json();
        }

        async function updateRecommendedTables(audioFile, tableNames, userName, staffName) {
            const formData = new FormData();
            formData.append('audioFile', audioFile);
            formData.append('targetTables', JSON.stringify(tableNames));
            formData.append('userName', userName);
            formData.append('staffName', staffName);

            const response = await fetch(`${API_BASE}/api/database/process-audio`, {
                method: 'POST',
                body: formData
            });

            return await response.json();
        }

        // APIè¨­å®šçŠ¶æ³ã®ç¢ºèªã¨è¡¨ç¤º
        async function checkApiConfiguration() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                // APIè¨­å®šçŠ¶æ³ã‚’è¡¨ç¤º
                const configInfo = document.createElement('div');
                configInfo.style.cssText = 'background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #3498db;';
                
                const hasApiKeys = data.openai_configured && data.anthropic_configured;
                
                configInfo.innerHTML = `
                    <h3 style="margin: 0 0 10px 0; color: #2c3e50;">ğŸ”§ APIè¨­å®šçŠ¶æ³</h3>
                    <p style="margin: 5px 0;">OpenAI API: ${data.openai_configured ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'}</p>
                    <p style="margin: 5px 0;">Anthropic API: ${data.anthropic_configured ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'}</p>
                    <p style="margin: 10px 0 5px 0; font-weight: bold; color: ${hasApiKeys ? '#27ae60' : '#e74c3c'};">                    
                        ${hasApiKeys ? 
                          'ğŸ‰ å…¨æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼' : 
                          'âš ï¸ ãƒ‡ãƒ¢æ©Ÿèƒ½ã®ã¿åˆ©ç”¨å¯èƒ½ - å®Ÿéš›ã®éŸ³å£°èªè­˜ã«ã¯APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™'}
                    </p>
                    ${!hasApiKeys ? '<p style="margin: 5px 0; font-size: 14px; color: #666;">APIã‚­ãƒ¼è¨­å®šæ–¹æ³•ã¯ <a href="#" onclick="alert(\'README.mdã¾ãŸã¯API_TEST_TROUBLESHOOTING.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„\');">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰</a> ã‚’å‚ç…§</p>' : ''}
                `;
                
                document.querySelector('.container').insertBefore(configInfo, document.querySelector('.tabs'));
                
            } catch (error) {
                console.warn('API configuration check failed:', error);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        window.addEventListener('load', () => {
            checkServerHealth();
            checkApiConfiguration();
        });
    </script>
</body>
</html>